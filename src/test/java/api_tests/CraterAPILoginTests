package api_tests;

import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;
import io.restassured.http.ContentType;
import io.restassured.response.Response;
import utilities.BrowserUtils;
import org.testng.Assert;
import static io.restassured.RestAssured.*;

public class CraterAPILoginTests {

	BrowserUtils utils = new BrowserUtils();
	Response response;
	String token;
	
	@BeforeTest
	public void setup() {
		baseURI = "http://crater.primetech-apps.com/api/v1";
	}
	
	@Test
	public void getStatus() {
		String endpoint = "/auth/login";
		String requestBody = "{\n"
				+ "    \"username\": \"entityadmin@primetechschool.com\",\n"
				+ "    \"password\" : \"primetech@school\",\n"
				+ "    \"device_name\":\"mobile_app\"\n"
				+ "}";
				
		
		response = given().header("Authorization", "Bearer <406|sJpI2fWB6Qs8iCQ8Kf30QKc4sGJSC1A7eKzMpbMN>").header("Company", "1").accept(ContentType.JSON).contentType("application/json").body(requestBody).post(endpoint).thenReturn();
		
		System.out.println(response.getBody().asString());
		Assert.assertEquals(response.getStatusCode(), 200);
	}
	
	@Test (dependsOnMethods = "getStatus")
	public void getBody() {
		token = "125|WeV9Q75LCHNY46ypIv1oZ2eBY0r4setFf0eotX8J";
		
		String endpoint = "/auth/login";
		String requestBody = "{\n"
				+ "    \"username\": \"entityadmin@primetechschool.com\",\n"
				+ "    \"password\" : \"primetech@school\",\n"
				+ "    \"device_name\":\"mobile_app\"\n"
				+ "}";
		
		response = given().contentType("application/json")
				.accept(ContentType.JSON)
				.post()
				.thenReturn();
				
				response.prettyPrint();
				Assert.assertEquals(response.getStatusCode(), 200);
				
//		response.prettyPrint()
//		Assert.assertEquals(response.getStatusCode(), 200);
//		Assert.assertEquals(response.getContentType(), "application/json");
		
		
		
//		response.prettyPrint();
//		Assert.assertEquals(response.getStatusCode(), 200);
//		Assert.assertEquals(response.getContentType(), "application/json");
//		Assert.assertEquals(response.jsonPath().getString("token"), token);
//		
//		System.out.println(response.path("type").toString());
//		System.out.println(response.jsonPath().get("token").toString());
	}
}
